<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="todo.css" />
  </head>

  <body>
    <header>
      <nav>
        <div>
          <li>Add</li>
          <li>View</li>
        </div>
      </nav>
    </header>
    <main>
      <section>
        <form action="">
          <!-- Title -->
          <label for="title">Title</label>
          <input
            type="text"
            id="title"
            name="title"
            placeholder="Enter title"
            required
          />
          <small id="titleRequired"></small>

          <!-- Price -->
          <label for="price">Price</label>
          <input
            type="number"
            id="price"
            name="price"
            placeholder="Enter price"
            step="0.01"
            required
          />
          <small id="priceRequired"></small>

          <!-- Category -->
          <label for="category">Category</label>
          <input
            type="text"
            id="category"
            name="category"
            placeholder="Enter category"
            required
          />
          <small id="categoryRequried"></small>

          <!-- Image -->
          <label for="image">Image</label>
          <input
            type="file"
            id="image"
            name="image"
            accept="image/*"
            required
          />
          <small id="imageRequired"></small>

          <!-- Description -->
          <label for="description">Description</label>
          <textarea
            id="description"
            name="description"
            placeholder="Enter description"
            rows="4"
            required
          ></textarea>
          <small id="descRequired"></small>

          <!-- Submit button -->
          <button type="submit" onclick="formData()">Submit</button>
        </form>
      </section>
      <section>
        <table>
          <thead>
            <tr>
              <th rowspan="2">ID</th>
              <th rowspan="2">Title</th>
              <th rowspan="2">Price</th>
              <th rowspan="2">Description</th>
              <th rowspan="2">Category</th>
              <th rowspan="2">Image</th>
              <th colspan="2">Rating</th>
              <th rowspan="2">Action</th>
            </tr>
            <tr>
              <th>Rate</th>
              <th>Count</th>
            </tr>
          </thead>

          <tbody id="renderBody"></tbody>
        </table>
      </section>
    </main>
    <script>
      // use value from form
      let titleData = document.getElementById("title");
      let priceData = document.getElementById("price");
      let categoryData = document.getElementById("category");
      let imageField = document.getElementById("image");
      let descriptionData = document.getElementById("description");

      let renderData = document.getElementById("renderBody");

      // for required field
      let titleRequired = document.getElementById("titleRequired");
      let priceRequired = document.getElementById("priceRequired");
      let categoryRequired = document.getElementById("categoryRequired");
      let imageRequired = document.getElementById("imageRequired");
      let descRequired = document.getElementById("descRequired");

      function formData() {
        const title = titleData.value;
        const price = priceData.value;
        const category = categoryData.value;
        const image = imageField.value;
        const description = descriptionData.value;

        if (title === "") {
          titleRequired.innerHTML = "This field required";
        }
        if (price === "") {
          priceRequired.innerHTML = "This field required";
        }
        if (category === "") {
          categoryRequired.innerHTML = "This field required";
        }
        if (image === "") {
          imageRequired.innerHTML = "This field required";
        }
        if (description === "") {
          descRequired.innerHTML = "This field required";
        }
        const value = { title, price, category, image, description };
        productDataPost(value);
      }

      // fetch data and show
      function renderTemplate(data) {
        return ` <tr id="dataRemove">
              <td>${data.id}</td>
              <td>${data.title}</td>
              <td>$${data.price}</td>
              <td>${data.description}</td>
              <td>${data.category}</td>
              <td><img src="${data.image}" alt="image fetch" width="120px" height="150px"></td>
              <td>${data.rating.rate}</td>
              <td>${data.rating.count}</td>
              <td>
                <button onclick="editProductData(${data.id})">Edit</button>
                <button  onclick="removeData(${data.id})">Delete</button>
              </td>
            </tr>`;
      }

      async function productDataPost(data) {
        try {
          const response = await fetch("https://fakestoreapi.com/products", {
            method: "POST",
            headers: {
              "content-type": "application/json",
            },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            console.log(`Data submitted sucessfully`);
          }
        } catch (error) {
          console.log(error);
        }
      }

      async function showUserData() {
        try {
          const response = await fetch("https://fakestoreapi.com/products", {
            method: "GET",
          });
          const data = await response.json();

          if (response.ok) {
            console.log("Data fetched sucessfully");
          }

          const renderTemplateData = data.map((value) => {
            return renderTemplate(value);
          });

          renderData.innerHTML = renderTemplateData.join("");
        } catch (error) {
          console.log(error);
        }
      }

      showUserData();

      // delete the data
      async function removeData(id) {
        const repsonse = await fetch(
          `https://fakestoreapi.com/products/${id}/`,
          {
            method: "DELETE",
          },
        );
        if (repsonse.ok) {
          document.getElementById("dataRemove").remove();
          alert(`Data with id ${id} removed`);
          // showUserData()
        }
      }

      //edit user data
      async function editProductData(id) {
        try {
          const response = await fetch(
            `https://fakestoreapi.com/products/${id}/`,
          );
          if (!response.ok) {
            throw new Error(await res.text());
          }
          const responseData = await response.json();
          document.getElementById("title").value = responseData.title;
          document.getElementById("price").value = responseData.price;
          document.getElementById("category").value = responseData.category;
          document.getElementById("description").value =
            responseData.description;
          document.getElementById("image").value = responseData.image;
          document.getElementById("id").value = responseData.id;
        } catch (error) {
          console.log(error);
        }
      }
      function clearProduct() {
        document.getElementById("title").value = "";
        document.getElementById("price").value = "";
        document.getElementById("category").value = "";
        document.getElementById("description").value = "";
        document.getElementById("image").value = "";
        document.getElementById("id").value = "";
      }

      function getProductValues() {
        let title = getElementsValue("title");
        let price = getElementsValue("price");
        let description = getElementsValue("description");
        let category = getElementsValue("category");
        let image = getElementsValue("image");
        let id = getElementsValue("id");

        return { title, price, description, category, image, id };
      }

      async function createProduct() {
        let bodyData = getProductValues();
        if (!bodyData) {
          return;
        }
        try {
          let res;
          if (bodyData.id) {
            res = await fetch(
              `https://fakestoreapi.com/products/${bodyData.id}`,
              {
                method: "PUT",
                headers: {
                  "content-type": "application/json",
                },
                body: JSON.stringify(bodyData),
              },
            );
          } else {
            res = await fetch("https://fakestoreapi.com/products", {
              method: "POST",
              headers: {
                "content-type": "application/json",
              },
              body: JSON.stringify(bodyData),
            });
          }
          if (!res.ok) {
            throw new Error(await res.text());
          }
          const responseData = await res.json();
          clearfields();
          productFetch();
          if (bodyData.id) {
            alert("product with id: " + responseData.id + " updated");
          } else alert(responseData.title + " Added successfully");
        } catch (error) {
          console.log(error);
        }
      }
    </script>
  </body>
</html>
