<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="todo.css" />

  </head>
  <body>
    <main>
      <section id="todo-section" class="todo-container">
        <div id="todo-form" class="todo-form">
          <div class="form-group">
            <label for="todo-title">Title:</label>
            <input type="text" id="todo-title" class="form-input" />
          </div>

          <div class="form-group">
            <label for="todo-priority">Priority:</label>
            <select id="todo-priority" class="form-select">
              <option disabled selected>Select option</option>
              <option value="HIGH">High</option>
              <option value="MEDIUM">Medium</option>
              <option value="LOW">Low</option>
            </select>
          </div>

          <div class="form-group">
            <label for="todo-final-date">Final Date:</label>
            <input type="date" id="todo-final-date" class="form-input" />
          </div>

          <div class="form-group">
            <label>Is Important:</label>
            <div class="radio-group">
              <input
                type="radio"
                name="todo-important"
                id="important-yes"
                value="yes"
              />
              <label for="important-yes">Yes</label>

              <input
                type="radio"
                name="todo-important"
                id="important-no"
                value="no"
              />
              <label for="important-no">No</label>
            </div>
          </div>

          <div class="form-group">
            <label for="todo-description">Description:</label>
            <textarea id="todo-description" class="form-textarea"></textarea>
          </div>

          <button type="submit" id="todo-submit-btn" class="btn-primary" onclick="postDataFromUser()">
            Add Todo
          </button>
        </div>
      </section>

      <section>
         

<div class="relative overflow-x-auto bg-neutral-primary-soft shadow-xs rounded-base border border-default">
    <table class="w-full text-sm text-left rtl:text-right text-body">
        <thead class="text-sm text-body bg-neutral-secondary-medium border-b border-default-medium">
            <tr>
                <th scope="col" class="px-6 py-3 font-medium">ID</th>
                <th scope="col" class="px-6 py-3 font-medium">Title</th>
                <th scope="col" class="px-6 py-3 font-medium">priority</th>
                <th scope="col" class="px-6 py-3 font-medium">completed</th>
                <th scope="col" class="px-6 py-3 font-medium">final_date</th>
                <th scope="col" class="px-6 py-3 font-medium">Due_date</th>
                <th scope="col" class="px-6 py-3 font-medium">Is_important</th>
                <th scope="col" class="px-6 py-3 font-medium">Description</th>
                <th scope="col" class="px-6 py-3 font-medium">Created_at</th>
                <th scope="col" class="px-6 py-3 font-medium">Updated_at</th>
                <th scope="col" class="px-6 py-3 font-medium">Action</th>
            </tr>
        </thead>
        <tbody id="tableBody">
           
        </tbody>
    </table>
</div>


      </section>
      <section></section>
      <section></section>
    </main>
    <script>


        let titleData=document.getElementById("todo-title")
        let priorityData=document.getElementById("todo-priority")
        let final_data=document.getElementById("todo-final-date")
        let isImportandYes=document.getElementById("important-yes")
        let isImportandNo=document.getElementById("important-no")

        let renderingTemplateData=document.getElementById("tableBody")


        function postDataFromUser(){
            const title=titleData.value 
            const priority=priorityData.value 
            const final_date=final_data.value 
            const isImportData=isImportandYes.value 
            const isImportantData=isImportandNo.value

            let is_important
            if(title===""){
                alert("Title field required")
            }
            if(priority===""){
                alert("priorityData is required")
            }
            if(final_date===""){
                alert("final Date is required")
            }
            if(isImportData!==""){
                is_important=true
            }
            if(isImportandNo!==""){
               is_important=true
            }

            const todoData={title,priority,final_date,is_important}
            postDataUser(todoData)
        
        }

        // render the template 
        function renderTemplate(data){
          return ` <tr  id="row_class" class="bg-neutral-primary-soft border-b  border-default">
                <th scope="row" class="px-6 py-4 font-medium text-heading whitespace-nowrap">${data.id}<th>
                <td class="px-6 py-4">${data.title}</td>
                <td class="px-6 py-4">${data.priority.toLowerCase()}</td>
                <td class="px-6 py-4">${data.completed}</td>
                <td class="px-6 py-4 text-right">${data.final_date}</td>
                <td class="px-6 py-4">${data.due_date}</td>
                <td class="px-6 py-4">${data.is_important}</td>
                <td class="px-6 py-4">${data.description}</td>
                <td class="px-6 py-4">${data.created_at}</td>
                <td class="px-6 py-4">${data.updated_at}</td>
                <td class="px-6 py-4">
<button onclick="deleteData(${data.id})">
            Delete
          </button>
                  </td>
            </tr>`
        }

        async function fetchApiUser() {
          try {
            const response=await fetch(`http://127.0.0.1:8000/ecommerceApi/todo/`,{method:"GET"})
            const toDOdata=await response.json()

            if(response.ok){
              console.log("fetched data sucessfully !!!!")
            }
            const userMapper=toDOdata.map((value)=>{
              return renderTemplate(value)
            })

            renderingTemplateData.innerHTML=userMapper.join("")

          } catch (error) {
             console.log(error)
          }
          
        }
      console.log("after fetching")
      fetchApiUser()



        // post the data
        async function postDataUser(userData) {
            try {
                const response=await fetch(`http://127.0.0.1:8000/ecommerceApi/todo/`,{
                    method:"POST",
                    headers:{
                        "content-type":"application/json"
                    },
                    body:JSON.stringify(userData)
                })
                if(response.ok){
                    alert("Submitted sucessfully")
                }else{
                    console.log("Invalid response")
                }
            } catch (error) {
                console.log(error)
                
            }
            
         }

        //  # delete option 
        async function deleteData(id){
          try {
            const response=await fetch(`http://127.0.0.1:8000/ecommerceApi/todo/${id}/`,{
              method:"DELETE"
            })
            if(response.ok){
              alert("Data removed sucessfully")
              fetchApiUser()   //re fetch api for updated list 

            }else{
              console.log("Data not removed")
            }
            document.getElementById("row_class").remove()
            
          } catch (error) {
            console.log(error)
            
          }

        }

        postDataFromUser()
    </script>
  </body>
</html>
